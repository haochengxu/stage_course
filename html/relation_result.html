<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
  <meta name="format-detection" content="telephone=no">
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="telephone=no" name="format-detection">
  <title>幸福雷达测评 结果</title>
  <!-- <link href="../css/reset.css" rel="stylesheet" type="text/css"/> -->
  <link href="../css/style.css" rel="stylesheet" type="text/css"/>
  <link href="../css/weui.css" rel="stylesheet" type="text/css"/>
  <style>
    img {
      width: 115px;
      height: 130px;
      position: absolute;
      top: 20px;
      left: 20px;
    }
    h1 {
      font-size: 35px;
      padding: 160px 0 150px 0;
      background-color: rgb(68, 112, 233);
      color: white;
    }
    h1 span {
      font-size: 28px;
    }
    .start_page {
      text-align: center;
      font-size: 16px;
    }
    .question {
      position: relative;
    }
    .question p {
      letter-spacing: 1px;
      margin: 0 auto;
      margin-left: 4%;
      position: relative;
      float: left;
      /*top: -50px;*/
      background-color: white;
      padding: 15px;
      color: #666;
      /*border: 2px solid rgb(68, 112, 233);*/
    }
    .weui-cell_select {
      width: 40%;
      margin: 0 auto;
    }
    .button-sp-area {
      clear: both;
      margin: 0 auto;
      padding: 21px 0;
      width: 40%;
    }
    .weui-btn_plain-default {
      color: white;
      border: none;
      background-color: rgb(68, 112, 233);
    }
    .aOverB, .aEqualB, .less, .more {
      display: none;
    }
    #chart {
      /*float: left;*/
      margin: 0 auto;
      margin-left: 20px;
      margin-top: 40px;
      /*width: 50%;*/
      height: 400px;
    }
    .title {
      color: #333;
      display: inline-block;
      padding: 20px 0px 10px 0;
    }
  </style>
</head>
<body>
  <div class="start_page">
    <img src="../image/box_cat.png"/>
    <h1>
      幸福雷达测评<br />
      <span>测评结果</span>
      <span style="position: absolute;top: 25px;right: 30px;font-size: 22px;">欢迎你，<span id="name" style="font-size: 22px;"></span></span>
    </h1>
  </div>
  <div class="question">
    <div id="chart">
    </div>
    <p>
      这一次测评的是：你作为评估人，和四位最重视的关系人之间，对彼此关系的满意度，从两人两个世界来先后感知，看看在关系中，有哪些你所不知道
      的情况存在。接下来是你和你提到的四位人生中最重要的人之间的关系。那么测评结果是：
      <br />
      <span class="title">第一段关系</span><br />
      <span id="first_me"></span><br />
      <span id="first_op"></span><br />
      <span id="first_diff"></span><br />
      <br />
      <span class="title">第二段关系</span><br />
      <span id="second_me"></span><br />
      <span id="second_op"></span><br />
      <span id="second_diff"></span><br />
      <br />
      <span class="title">第三段关系</span><br />
      <span id="third_me"></span><br />
      <span id="third_op"></span><br />
      <span id="third_diff"></span><br />
      <br />
      <span class="title">第四段关系</span><br />
      <span id="forth_me"></span><br />
      <span id="forth_op"></span><br />
      <span id="forth_diff"></span><br />
    </p>
    <div class="button-sp-area">
      <a id="next" href="javascript:;" class="weui-btn weui-btn_plain-default">返回</a>
    </div>
  </div>
<script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>
<script src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/echarts/3.2.3/echarts.min.js"></script>
<script>

  var relationDescription0 = {
    '0': '恭喜你，看起来你十分满意，这种感觉一定让你很喜欢和对方在一起。',
    '1': '恭喜你，看起来你相当满意，作为你最最重视的人，能有这样的分值，你应该很享受这个关系，对方一定很棒，不是吗？',
    '2': '这段关系你还算满意，不过，显然还有提升的空间，既然对方是你最最重视的人，应该花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福来源。',
    '3': '这段关系看来不太理想，既然对方是你最最重视的人，应该认真花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福来源。',
    '4':'这段关系看来非常不理想哦，既然对方是你最最重视的人，系统十分建议你立刻认真花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福来源。',
    '5':'这段关系在你看来糟透了，一定每一次想到都会让你头疼，既然对方是你最最重视的人，系统十分建议你立刻认真花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福来源。'
  }
  var relationDescription1 = {
    '0': '看起来对方十分满意，这种感觉一定让对方很喜欢和你在一起。',
    '1': '看起来对方相当满意，作为对方最最重视的人，能有这样的分值，对方应该很享受这个关系，你一定很棒，不是吗？',
    '2': '这段关系对方还算满意，不过，显然还有提升的空间，既然对方是你最最重视的人，应该花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福质量。',
    '3': '这段关系看来不太理想，既然对方是你最最重视的人，应该认真花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福质量。',
    '4':'这段关系看来非常不理想哦，既然对方是你最最重视的人，应该花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福质量。',
    '5':'这段关系在对方看来糟透了，一定每一次想到都会让对方头疼，既然对方是你最最重视的人，系统十分建议你立刻解决这一问题，认真花一些时间研究如何提升这一关系的链接质量，因为这决定了你的幸福质量。'
  }
  var exceptions = {
    '0': '系统检测出来的一个不太好的消息：看起来你非常不满意对方，而且值得重视的是，在你不满意的同时，对方似乎不太受到你的冷漠态度的影响，发生这样的情况有两种可能：要么你太会隐藏你的不满，要么对方对你的爱是无条件的。你不仅应该更加珍视这段关系，并应该尽快改善，将你自己内心的不满，以科学的方式进行沟通，否则这种情感天平失衡的状态在未来是难以长久的。',
    '1':'这个关系中存在一个信息值得你高度重视：相比对方而言，你对这个关系更加不满意，而且很明显，这就意味着，你和对方的沟通存在较大的问题，如果对方是你生命中如此重要的人，那么这种情况就是在消耗你自己的幸福感，因为幸福感主要来自重要关系的链接质量。同时，如果你不太擅长遮掩自己的情绪，这个关系会受到你不知不觉中的伤害。既然对方如此重要，请重视此情况，采取科学措施，避免日后才发觉有更多的遗憾。',
    '2':'这一关系中存在一个信息值得你要重视起来：相比对方而言，你对这个关系更不满意，这就意味着，你和对方的沟通存在一定的问题，如果对方是你生命中如此重要的人，那么这种情况就是在消耗你自己的幸福感，因为幸福感主要来自重要关系的链接质量。同时，如果你不太擅长遮掩自己的态度，这个关系会受到你不知不觉中的损伤。既然对方如此重要，请重视此情况，采取科学措施，避免日后引发更多的遗憾。',
    '3':'这个关系中存在一个有趣的信息，你和对方看待这个关系的满意度竟然相同，这比较少见，出现这种情况有两种可能，如果不是你懒得进入对方的世界深入体验和思考，那就是你们之间的关系彼此很真实坦诚，没有什么隐藏。',
    '4':'此关系中存在一个信息值得你要重视起来：相比你而言，对方对这个关系更不满意，这就意味着，你和对方的沟通存在一定的问题，如果对方是你生命中如此重要的人，那么这种情况就是在消耗你自己的幸福感，因为幸福感主要来自重要关系的链接质量。同时，如果对方不太擅长遮掩自己的情绪，这个关系会受到对方不知不觉中的损伤。既然对方如此重要，请重视此情况，采取措施，增加科学有效的沟通，避免日后引发更多的遗憾。',
    '5':'此关系中有一个信息值得你要重视起来：相比你而言，对方对这个关系更不满意，这就意味着，你和对方的沟通存在一定的问题，如果对方是你生命中如此重要的人，那么这种情况就是在消耗你自己的幸福感，因为幸福感主要来自重要关系的链接质量。同时，如果对方不太擅长遮掩自己的情绪，你会受到对方不知不觉中的隐形的伤害。既然对方如此重要，请重视此情况，采取措施，增加科学有效的沟通，避免日后引发更多的遗憾。',
    '6':'系统检测出来的一个不太好的消息：看起来对方非常不满意你，而且值得重视的是，在对方不满意的同时，你似乎不太受到对方的冷漠态度的影响，发生这样的情况有两种可能：要么对方太会隐藏自己的不满，要么你对对方的爱是无条件的。你不仅应该更加珍视这段关系，并应该尽快改善，用科学有效的沟通，找到让对方内心不满的深层原因，否则这种情感天平失衡的状态在未来是难以长久的。'
  }
  //分数映射
  var map1 = [
    [10],
    [9,8],
    [7,6],
    [4,5],
    [2,3],
    [1]
  ]
  //分数映射
  var map2 = [
    [-4,-5,-6,-7,-8,-9,-10],
    [-2,-3],
    [-1],
    [0],
    [1],
    [2,3],
    [4,5,6,7,8,9,10],
  ]
  // 应用 ID，用来识别应用
  var APP_ID = 'JppVTp1E3NxhFhfpRpoTwDco-gzGzoHsz';

  // 应用 Key，用来校验权限（Web 端可以配置安全域名来保护数据安全）
  var APP_KEY = '5bkthPBiagLdabY4kl5cwbsj';

  // 初始化
  AV.init({
  appId: APP_ID,
  appKey: APP_KEY
  });
  var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
          sURLVariables = sPageURL.split('&'),
          sParameterName,
          i;

      for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');

          if (sParameterName[0] === sParam) {
              return sParameterName[1] === undefined ? true : sParameterName[1];
          }
      }
  };

  var query = new AV.Query('Customer');
  query.get(getUrlParameter('id')).then(function (customer) {
    document.getElementById('name').textContent = customer.get('name')
    var gradeArray = [
      customer.get('relation_person1_me'),
            customer.get('relation_person1_opposite'),
      customer.get('relation_person2_me'),
            customer.get('relation_person2_opposite'),
      customer.get('relation_person3_me'),
            customer.get('relation_person3_opposite'),
      customer.get('relation_person4_me'),
      customer.get('relation_person4_opposite')
    ]
    option.series[0].data.forEach(function(value, index) {
      value.value = gradeArray[index]
      value.name = value.name + '(' + gradeArray[index] + ')'
    })
    myChart.setOption(option);


    var first = customer.get('relation_person1_me') - customer.get('relation_person1_opposite')
    var second = customer.get('relation_person2_me') - customer.get('relation_person2_opposite')
    var third = customer.get('relation_person3_me') - customer.get('relation_person3_opposite')
    var forth = customer.get('relation_person4_me') - customer.get('relation_person4_opposite')
    map1.forEach(function(value, index){
      if (value.indexOf((Number(customer.get('relation_person1_me')))) != -1) {
        $('#first_me')[0].textContent = (relationDescription0[index])
      }
      if (value.indexOf((Number(customer.get('relation_person1_opposite')))) != -1) {
        $('#first_op')[0].textContent = (relationDescription1[index])
      }
      if (value.indexOf((Number(customer.get('relation_person2_me')))) != -1) {
        $('#second_me')[0].textContent = (relationDescription0[index])
      }
      if (value.indexOf((Number(customer.get('relation_person2_opposite')))) != -1) {
        $('#second_op')[0].textContent = (relationDescription1[index])
      }
      if (value.indexOf((Number(customer.get('relation_person3_me')))) != -1) {
        $('#third_me')[0].textContent = (relationDescription0[index])
      }
      if (value.indexOf((Number(customer.get('relation_person3_opposite')))) != -1) {
        $('#third_op')[0].textContent = (relationDescription1[index])
      }
      if (value.indexOf((Number(customer.get('relation_person4_me')))) != -1) {
        $('#forth_me')[0].textContent = (relationDescription0[index])
      }
      if (value.indexOf((Number(customer.get('relation_person4_opposite')))) != -1) {
        $('#forth_op')[0].textContent = (relationDescription1[index])
      }
    })
    map2.forEach(function(value, index){
      if (value.indexOf(first) != -1) {
        $('#first_diff')[0].textContent = (exceptions[index])
      }
      if (value.indexOf(second) != -1) {
        $('#second_diff')[0].textContent = (exceptions[index])
      }
      if (value.indexOf(third) != -1) {
        $('#third_diff')[0].textContent = (exceptions[index])
      }
      if (value.indexOf(forth) != -1) {
        $('#forth_diff')[0].textContent = (exceptions[index])
      }
    })
  }, function (error) {
    // 失败了
    console.log(error);
  });

  $("#next").on('click', function(e){
    location.href="./navigator.html?id=" + getUrlParameter('id')+ '&name=' + getUrlParameter('name')
  })

  var option = {
    title : {
        text: '4X2体验',
        // subtext: '纯属虚构',
        x:'center'
    },
    tooltip : {
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c} ({d}%)"
    },
    legend: {
        x : 'center',
        y : 'bottom',
        data:['rose1','rose2','rose3','rose4','rose5','rose6','rose7','rose8']
    },
    toolbox: {
        show : true,
        feature : {
            // mark : {show: true},
            // dataView : {show: true, readOnly: false},
            magicType : {
                show: true,
                type: ['pie', 'funnel']
            },
            // restore : {show: true},
            // saveAsImage : {show: true}
        }
    },
    calculable : true,
    series : [
        {
            name:'面积模式',
            type:'pie',
            radius : [30, 110],
            center : ['50%', '50%'],
            roseType : 'area',
            data:[
                {value:10, name:'我对关系人一'},
                {value:20, name:'关系人一对我'},
                {value:5, name:'我对关系人二'},
                {value:35, name:'关系人二对我'},
                {value:15, name:'我对关系人三'},
                {value:30, name:'关系人三对我'},
                {value:25, name:'我对关系人四'},
                {value:40, name:'关系人四对我'}
            ]
        }
    ]
};
document.getElementById('name').textContent = getUrlParameter('name')


  // 基于准备好的dom，初始化echarts实例
  var myChart = echarts.init(document.getElementById('chart'));
    // 指定图表的配置项和数据
  //   option = {
  //     backgroundColor: '#2c343c',
  //
  //     title: {
  //         text: '4X2体验',
  //         left: 'center',
  //         top: 20,
  //         textStyle: {
  //             color: '#ccc'
  //         }
  //     },
  //
  //     tooltip : {
  //         trigger: 'item',
  //         formatter: "{a} <br/>{b} : {c} ({d}%)"
  //     },
  //
  //     visualMap: {
  //         show: false,
  //         min: 80,
  //         max: 600,
  //         inRange: {
  //             colorLightness: [0, 1]
  //         }
  //     },
  //     series : [
  //         {
  //             name:'访问来源',
  //             type:'pie',
  //             radius : '55%',
  //             center: ['50%', '50%'],
  //             data:[
  //                 {value:500, name:'成就'},
  //                 {value:700, name:'身心'},
  //                 {value:1000, name:'精神'},
  //                 {value:1000, name:'关系'},
  //             ].sort(function (a, b) { return a.value - b.value}),
  //             roseType: 'angle',
  //             label: {
  //                 normal: {
  //                     textStyle: {
  //                         color: 'rgba(255, 255, 255, 0.3)'
  //                     }
  //                 }
  //             },
  //             labelLine: {
  //                 normal: {
  //                     lineStyle: {
  //                         color: 'rgba(255, 255, 255, 0.3)'
  //                     },
  //                     smooth: 0.2,
  //                     length: 10,
  //                     length2: 20
  //                 }
  //             },
  //             itemStyle: {
  //                 normal: {
  //                     color: '#c23531',
  //                     shadowBlur: 200,
  //                     shadowColor: 'rgba(0, 0, 0, 0.5)'
  //                 }
  //             }
  //         }
  //     ]
  // };

  // 使用刚指定的配置项和数据显示图表。


</script>
</body>
</html>
